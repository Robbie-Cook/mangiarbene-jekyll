I"ùA<p>One of the best so called <strong>unusual use cases of Jekyll</strong> is learning the basics of web development: HTML, CSS and JavaScript. But as the JavaScript part is growing in your application, the need of a package manager like npm comes around, and with that we reach the limits of using Jekyll. Although not impossible to integrate with npm, the production environment might become too complicated, using two different compilers at the same time. Yet we don‚Äôt have to say goodbye to Jekyll at this point at all.</p>

<blockquote>
  <p>It is very well possible to use Jekyll in creating API endpoints, that can be consumed by other website generators. In this demo I will show the combination with React. That way you are completely free in your development, while enjoying the bennefits of a simple, static and blog-aware Jekyll application. This time as a real backend.</p>
</blockquote>

<h2 id="mangiarbene">MangiarBene</h2>

<p>We start with a simple Jekyll website called <strong>MangiarBene</strong>, which in this case is the actual website you are visiting right now. It constraints of two collections of <strong>15 cookbooks</strong> and <strong>48 recipes</strong> as well as a <strong>blog</strong> from which this actual post is the ‚Äòlatest‚Äô.</p>

<p>You can go to the <a href="/">homepage</a> of <strong>MangiarBene</strong> now, if you want, and see how the website is structured. Finally we can go to a different SPA website (in React), which I developed for this demo, that just uses the content from <strong>MangiarBene</strong> as JSON data. But let me explain first.</p>

<h2 id="many-to-many-relationships">Many to many relationships</h2>

<p>In Jekyll it is possible to relate collections and posts from the content of the YAML front matter blocks. We can call the recipes of a book, using the condition:</p>

<p><strong>if recipe.book == page.title</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"book-links"</span><span class="nt">&gt;</span>
    {%- for recipe in site.recipes -%}
    {%- if recipe.book == page.title -%}
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/recipes/{{ recipe.title | slugify }}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h5&gt;</span>{{ recipe.title }} {{ recipe.index }}<span class="nt">&lt;/h5&gt;</span>
    <span class="nt">&lt;/a&gt;</span>
    {%- endif -%}
    {%- endfor -%}    
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>This way, we can get all the recipes of the collection recipes, along with all the data of that recipe and add it to a certain book of the collection books.</p>

<p>Likewise we can add the data of a book to a recipe:</p>

<p><strong>if book.title == page.book</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"recipe-box_credits"</span><span class="nt">&gt;</span>
    {%- for book in site.books -%}
    {%- if book.title == page.book -%}
        <span class="nt">&lt;h6&gt;</span>{{  book.title }}<span class="nt">&lt;/h6&gt;</span>    
        <span class="nt">&lt;p&gt;</span>{{  book.author }}<span class="nt">&lt;/p&gt;</span>     
        <span class="nt">&lt;p&gt;</span>{{  book.content | truncatewords: 20 }} <span class="nt">&lt;span&gt;</span>Read more &gt;<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>     
    {%- endif -%}
    {%- endfor -%}           
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Both result in a data schema that is similar to the many-to-many-relationships used in non-relational databases, like MongoDB. So what if in Jekyll we could use this technique to create a JSON file that contains the same structure, and make it available to the internet? And we sure can!</p>

<h2 id="constructing-the-api-endpoints">Constructing the API endpoints</h2>

<p>Create a folder called <strong>api</strong> with files for <strong>books.json</strong> and <strong>recipes.json</strong>. In the front matter block we just set the layout to null and that‚Äôs it. Now we can construct a JSON file and establish the same relations as we did before in creating the pages for books, recipes and posts.</p>

<p>There is only one problem here (fortunatly with a simple solution). In order to achieve valid JSON, the last iteration cannot end with a comma. Since the if-statement works as a filter, and therefore not all iterations will become valid, a comma cannot be avoided here. Let me explain.</p>

<p>In Liquid you can eleminate the last comma, with the <strong>unless forloop.last</strong> statement. But this wil not work in case the last forloop is not valid to the condition. In other words, the last forloop which is valid to the condition might not be the last forloop of the forloop as a whole. Resulting in the last comma.</p>

<p>The solution is to create a new empty array, while using the push method to gather the desired content. This way we get rid of the conditional statement.</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
layout: null
---
[ 
    <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">book</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">site.books</span><span class="w"> </span><span class="p">%}</span>
        {
            "index"    : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">index</span><span class="w"> </span><span class="p">}}</span>",
            "title"    : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">title</span><span class="w"> </span><span class="p">}}</span>",
            "id"       : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">title</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">slugify</span><span class="w"> </span><span class="p">}}</span>",
            "author"   : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">author</span><span class="w"> </span><span class="p">}}</span>",
            "publisher": "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">publisher</span><span class="w"> </span><span class="p">}}</span>",
            "year"     : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">year</span><span class="w"> </span><span class="p">}}</span>",
            "kitchen"  : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">kitchen</span><span class="w"> </span><span class="p">}}</span>",
            "link"     : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">link</span><span class="w"> </span><span class="p">}}</span>",
            "book_url" : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">book_url</span><span class="w"> </span><span class="p">}}</span>",
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">title</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">slugify</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">my_recipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">recipetitle</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">site.recipes</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">detitel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">recipetitle</span><span class="p">.</span><span class="nv">book</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">slugify</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">detitel</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">itemtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">itemtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">itemtitle</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span>recipetitle<span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">my_recipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">my_recipe</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span>itemtitle<span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
            <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
            "recipes"  : [ 
                <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">therecipe</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">my_recipe</span><span class="w"> </span><span class="p">%}</span>  
                {
                    "index"   : "<span class="p">{{</span><span class="w"> </span><span class="nv">therecipe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">index</span><span class="w"> </span><span class="p">}}</span>",
                    "title"   : "<span class="p">{{</span><span class="w"> </span><span class="nv">therecipe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">title</span><span class="w"> </span><span class="p">}}</span>",
                    "page"    : "<span class="p">{{</span><span class="w"> </span><span class="nv">therecipe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">page</span><span class="w"> </span><span class="p">}}</span>",
                    "product" : "<span class="p">{{</span><span class="w"> </span><span class="nv">therecipe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">product</span><span class="w"> </span><span class="p">}}</span>",
                    "dish"    : "<span class="p">{{</span><span class="w"> </span><span class="nv">therecipe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">dish</span><span class="w"> </span><span class="p">}}</span>"
                }<span class="p">{%</span><span class="w"> </span><span class="kr">unless</span><span class="w"> </span><span class="nv">forloop</span><span class="p">.</span><span class="nv">last</span><span class="w"> </span><span class="p">%}</span>,<span class="p">{%</span><span class="w"> </span><span class="kr">endunless</span><span class="w"> </span><span class="p">%}</span>
                <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
            ],
            "text"  : "<span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">text</span><span class="w"> </span><span class="p">}}</span>",
            "content"  : <span class="p">{{</span><span class="w"> </span><span class="nv">book</span><span class="p">.</span><span class="nv">content</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">jsonify</span><span class="w"> </span><span class="p">}}</span>
        }<span class="p">{%</span><span class="w"> </span><span class="kr">unless</span><span class="w"> </span><span class="nv">forloop</span><span class="p">.</span><span class="nv">last</span><span class="w"> </span><span class="p">%}</span>,<span class="p">{%</span><span class="w"> </span><span class="kr">endunless</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
]
</code></pre></div></div>

<p>Finally check if the JSON is valid go to: 
<a href="https://jsonlint.com/" target="_blank" rel="noopener noreferrer">
https://jsonlint.com/
</a>.</p>

<h2 id="jekyll-as-a-blog-api">Jekyll as a blog API</h2>

<p>More interesting maybe is the fact that we can use the same technique to create a blog API from the Jekyll data. Now in the <strong>data</strong> folder create a file called blog.json, and follow the same instructions as before. Here we want to use the <strong>content</strong> of a post as well, which contains the Liquid templating language, resulting in HTML tags in your output. Therefore you need to use the <strong>jsonify</strong> filter here.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
layout: null
---
[ 
    {% for book in site.books %}
        {
            "index"    : "{{ book.index }}",
            "title"    : "{{ book.title }}",
            <span class="c">&lt;!-- ... --&gt;</span>
            "content"  : {{ book.content | jsonify }}
        }{% unless forloop.last %},{% endunless %}{% endfor %}
]
</code></pre></div></div>

<h2 id="publishing-the-jekyll-site-on-cloudcannon">Publishing the Jekyll site on CloudCannon</h2>

<p>Publish the result on Github and Cloudcannon, which in this case I already did, obviously.</p>

<p>Now we can use the created Jekyll API endpoints. As you can see they are part of this actual website.</p>

<p><a href="https://trim-seahorse.cloudvent.net/api/recipes.json" target="_blank" rel="noopener noreferrer">
/api/recipes.json
</a>
<br />
<a href="https://trim-seahorse.cloudvent.net/api/books.json" target="_blank" rel="noopener noreferrer">
/api/books.json
</a>
<br />
<a href="https://trim-seahorse.cloudvent.net/api/blog.json" target="_blank" rel="noopener noreferrer">
/api/blog.json
</a></p>

<h2 id="using-the-api-in-react">Using the API in React</h2>

<p>Hosting the Jekyll website ‚Äì which includes the API endpoints ‚Äì on either GitHub or CloudCannon makes it easy to change the content, and see how this is in sync with the SPA that consumes the content, in this demo developed in React:</p>

<p><a href="https://api.roozen.nl" target="_blank" rel="noopener noreferrer">
https://api.roozen.nl
</a></p>

:ET